---
title: Get help with Connected Azure Gateway
linkTitle: Get help with Connected Azure Gateway
draft: false
weight: 40
---
Troubleshooting, error code and known limitations that you may encounter while working with the connected managed environment for Azure Gateway within Enterprise Marketplace.

## Troubleshooting

This section describe the common error cases you can encounter when using agents for the first time. If your error is not listed, please check the [Understand the agent log](/docs/connect_manage_environ/connect_azure_gateway/tips-and-troubleshooting/#understand-the-agent-logs) and [Error Codes and Mitigations](/docs/connect_manage_environ/connect_azure_gateway/tips-and-troubleshooting/#error-codes-and-mitigations) sections.

| Question                                                                                                                                                                                                                                                                                                                                                                             | Answer                                                                                                                                                                                                                                                                                                                                                                                                                      |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Why can't Discovery Agent connect to Azure Gateway?                                                                                                                                                                                                                                                                                                                                  | Make sure that the Azure configuration (`AZURE_SUBSCRIPTIONID`, `AZURE_TENANTID`, `AZURE_RESOURCEGROUPNAME`, `AZURE_CLIENTID`, `AZURE_CLIENTSECRET` and `AZURE_APIMSERVICENAME`) are correctly set.                                                                                                                                                                                                                         |
| Why can't Traceability Agent connect to Azure event hub?                                                                                                                                                                                                                                                                                                                             | Make sure that the Azure configuration (`AZURE_SUBSCRIPTIONID`, `AZURE_TENANTID`, `AZURE_RESOURCEGROUPNAME`, `AZURE_CLIENTID`, `AZURE_CLIENTSECRET`, `AZURE_APIMSERVICENAME`, `AZURE_EVENTHUBNAME`, `AZURE_EVENTHUBNAMESPACE`, `AZURE_EVENTHUBTIMEOUT`, `AZURE_SHAREDACCESSKEYNAME`, and `AZURE_SHAREDACCESSKEYVALUE`) are correctly set.                                                                                   |
| Why can't my agents connect to Amplify?                                                                                                                                                                                                                                                                                                                                              | Go to Amplify > Organization > Service Accounts and make sure that the Service Account is correctly named and valid (`CENTRAL_AUTH_CLIENTID`). Make sure that the organizationID (`CENTRAL_ORGANIZATIONID`) is correct. Verify the key's file name and path (`CENTRAL_AUTH_PUBLICKEY` and  `CENTRAL_AUTH_PRIVATEKEY`).                                                                                                      |
| I have the following error: Amplify Central - FAIL (error creating request header. bad response from AxwayId: 400 Bad Request)                                                                                                                                                                                                                                                       | Make sure that the Service Account set up is properly spelled (refer to `CENTRAL_AUTH_CLIENTID` property). Verify that the public/private key pair is the one corresponding to the Service Account (`CENTRAL_AUTH_PUBLICKEY` and  `CENTRAL_AUTH_PRIVATEKEY`).                                                                                                                                                               |
| I have the following 403 error: The client `11011f4a-67e9-4177-yyyy-xxxxx` with object id `11011f4a-67e9-4177-yyyy-xxxxx` does not have authorization to perform action `Microsoft.ApiManagement/service/apis/read` over scope `/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<resourceGroupName>/providers/Microsoft.ApiManagement/service/<serviceName>` or the scope is invalid | Make sure that the service principal the agent is using has the Contributor role available for the mentioned `<resourceGroupName>`.                                                                                                                                                                                                                                                                                         |
| Why don't I see traffic in Amplify Business insights?                                                                                                                                                                                                                                                                                                                                | Make sure that the `TRACEABILITY_HOST` and `TRACEABILITY_PORT` are accessible from the machine where Traceability Agent is installed. If you are using a proxy (`TRACEABILITY_PROXYURL`), make sure the connections are opened correctly. Refer to [Communication ports](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/#communication-ports).                                               |
| Why don't I see my Traceability Agent picking up any transactions?                                                                                                                                                                                                                                                                                                                   | It is possible that there's another application accessing the same streaming data. Make sure that the Traceability Agent is the only agent accessing the `$Default` consumer group in the event hub.  You can also take advantage of the `AZURE_EVENTHUBCONSUMERGROUP` variable to configure another consumer group. Refer to [Azure Agent Variables](/docs/connect_manage_environ/connect_azure_gateway/#agent-variables). |
| Why isn't my agent status displayed in the environment details page?                                                                                                                                                                                                                                                                                                                 | It is possible that your agents and their corresponding resources are not linked together. Follow [this procedure](/docs/connect_manage_environ/environment_agent_resources) to ensure the correct usage of agent resources.                                                                                                                                                                                                |
| Why is my Traceability Agent receiving EOF errors while sending transaction events?                                                                                                                                                                                                                                                                                                  | It is possible that the number of `TRACEABILITY_WORKER` is set too high. lower the number of configured workers.                                                                                                                                                                                                                                                                                                            |

## Understand the agent logs

Each log is displayed in a JSON format following this pattern: {"level":"info|debug|trace|warn","msg":"messageFromTheAgentGoesHere","time":"messageTimestamp"}

The agent logging mechanism is based on logrus (<https://github.com/sirupsen/logrus>) and can display several levels of information:

* **info** (default): informative log about the agent activity (start, stop, discovering API, publishing traffic, etc.).
* **debug**: same as info level plus some troubleshooting information (healthcheck, connection to Enterprise Marketplace / Gateway, etc.).
* **trace**: same as debug plus all information related to API call (action / duration / return code / endpoint).

The log level definition is provided using the `LOG_LEVEL` variable set in the agent configuration file.

The logs can be redirected either to stdout (default) or a file, or both (only applicable for discovery agent), using the `LOG_OUTPUT` variable set in the agent configuration file.

```shell
# redirecting log to stdout (Discovery / Traceability agents)
LOG_OUTPUT=stdout

# redirecting log to file (Discovery / Traceability agents)
LOG_OUTPUT=file

# redirecting log to output and file (Discovery agent only)
LOG_OUTPUT=both
```

For file output, the agent needs to know where to save the file and what the file name is. By default, the directory is `logs` where the agent is installed and the file name is based on the binary name you are running: `discovery_agent.log` or `traceability_agent.log`. This configuration can be changed using `LOG_FILE_PATH` and `LOG_FILE_NAME` variables in the agent configuration file. For the `LOG_FILE_PATH`, it is recommended to use an absolute path when running the agent in a non container mode.

```shell
# Sample configuration to redirect the agent logs to a specific directory and a specific file name
LOG_FILE_PATH=/home/APIC-agents/logs
LOG_FILE=agent-da-resgrp1.log

# Additional configuration for log rotation and backups
# The max size, in bytes that a log file can grow to - 10485760 (10 MB) by default.
LOG_FILE_ROTATEEVERYBYTES
# The max number of log file backups to keep - 7 by default.
LOG_FILE_KEEPFILES
# The max age of a backup file, in days - no limit by default but must be with the keepfiles amount.
LOG_FILE_CLEANBACKUPS
```

{{< alert title="Note" color="primary" >}}If you change any configuration, you must restart the agent to use the new configuration setting.{{< /alert >}}

## Error Codes and Mitigations

In case an error is encountered, the agent will automatically log it based on the logging definition (stdout and/or file).

The error message format is: `Component - [Error Code _ErrorCode_] error message`.

Below is the list of error codes and possible remediations.

| Code # | Description                                                                                                                                                                                                                 | Mitigation                                                                                                                                                                                                                                                                             |
|--------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|        | **Amplify Agent SDK errors**                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                        |
| 1001   | initialization error checking for dependencies to respond, possibly network or settings                                                                                                                                     | Typically, a previous error in the log is displayed. See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/) and [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables). |
| 1004   | error starting status update job                                                                                                                                                                                            | Internal system error. Contact your system administrator.                                                                                                                                                                                                                              |
| 1005   | error starting agent version checker                                                                                                                                                                                        | Build version is missing or of noncompliant semantic versioning. Check the build version of your agent.                                                                                                                                                                                |
| 1007   | grpc client is not connected to CENTRAL                                                                                                                                                                                     | Check `CENTRAL_URL` configuration. See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/) and make sure your outbound rules enable the connection to this url.                                                         |
| 1008   | harvester client is not connected to CENTRAL                                                                                                                                                                                | Check `CENTRAL_URL` configuration. See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/) and make sure your outbound rules enable the connection to this url.                                                         |
| 1100   | general configuration error in CENTRAL                                                                                                                                                                                      | `CENTRAL_AGENTNAME` is set but corresponding resources do not exist. Either [create agent resources](/docs/connect_manage_environ/environment_agent_resources) or remove the `CENTRAL_AGENTNAME` variable.                                                                             |
| 1101   | error attempting to query for ENVIRONMENT                                                                                                                                                                                   | Check that the Environment Name (`CENTRAL_ENVIRONMENT`) in configuration matches the name on Amplify.                                                                                                                                                                                  |
| 1102   | could not find specified team in Enterprise Marketplace, check CENTRAL_TEAM                                                                                                                                                 | Check that the Team Name (`CENTRAL_TEAM`) in configuration matches the name on Amplify.                                                                                                                                                                                                |
| 1110   | connection to Enterprise Marketplace failed                                                                                                                                                                                 | Check `CENTRAL_URL` configuration. See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/). If using a proxy to access Amplify, check that `CENTRAL_PROXYURL` is correctly defined.                                     |
| 1120   | request to Enterprise Marketplace failed                                                                                                                                                                                    | A request is not processed correctly. Set `LOG_LEVEL=trace` in agent configuration to retrieve the failing request and help diagnose the issue.                                                                                                                                        |
| 1130   | request to get authentication token failed                                                                                                                                                                                  | Check the `CENTRAL_AUTH_*` configuration (ClientId, Private and Public keys). Verify that you can connect to platform.axway.com. See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/).                               |
| 1131   | token retrieved but was invalid on request to Enterprise Marketplace                                                                                                                                                        | The token to communicate with Platform is not valid. The agent will try to get a new token. Check the `CENTRAL_AUTH_*` configuration (ClientId, Private and Public keys). See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).   |
| 1139   | couldn't find a subscriber email address based on the ID in the subscription event                                                                                                                                          | The user requesting this subscription may not have an email address set. Go to the platform > Organization > Users to verify the user email.                                                                                                                                           |
| 1147   | error parsing filter in configuration. Syntax error                                                                                                                                                                         | There is an issue with `AZURE_FILTER` variable. See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                             |
| 1148   | error parsing filter in configuration. Unrecognized expression                                                                                                                                                              | There is an issue with `AZURE_FILTER` variable. See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                             |
| 1149   | error parsing filter in configuration                                                                                                                                                                                       | There is an issue with `AZURE_FILTER` variable. See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                             |
| 1150   | error parsing filter in configuration. Invalid call argument                                                                                                                                                                | There is an issue with `AZURE_FILTER` variable. See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                             |
| 1151   | error parsing filter in configuration. Invalid selector type                                                                                                                                                                | There is an issue with `AZURE_FILTER` variable. See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                             |
| 1152   | error parsing filter in configuration. Invalid selector expression                                                                                                                                                          | There is an issue with `AZURE_FILTER` variable. See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                             |
| 1153   | error parsing filter in configuration. Invalid operator                                                                                                                                                                     | There is an issue with `AZURE_FILTER` variable. See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                             |
| 1154   | error parsing filter in configuration. Unrecognized condition                                                                                                                                                               | There is an issue with `AZURE_FILTER` variable. See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                             |
| 1160   | error getting endpoints for the API specification                                                                                                                                                                           | Verify that the OpenAPI Specification for the discovered API has available endpoints and operations on each endpoint.                                                                                                                                                                  |
| 1163   | error retrieving API service resource instances                                                                                                                                                                             | Verify that the service exists in Amplify Service Registry.                                                                                                                                                                                                                            |
| 1302   | error creating data for sending subscription notification                                                                                                                                                                   | Check Azure API Manager UI for configuration of API and its subscriptions.                                                                                                                                                                                                             |
| 1303   | email template not updated because an invalid authType was supplied                                                                                                                                                         | Check Azure API Manager UI for configuration of API and its subscriptions, specifically enabled authentication on the subscription.                                                                                                                                                    |
| 1401   | error parsing configuration values, check the config referenced in error                                                                                                                                                    | See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                                                                             |
| 1402   | error in overriding configuration using file with environment variables                                                                                                                                                     | Make sure the env_vars file exists and is properly formatted.                                                                                                                                                                                                                          |
| 1403   | invalid value for statusHealthCheckPeriod. Value must be between 1 and 5 minutes                                                                                                                                            | See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables/) variable `STATUS_HEALTHCHECKPERIOD`.                                                                                                                                        |
| 1404   | invalid value for statusHealthCheckInterval. Value must be between 30 seconds and 5 minutes                                                                                                                                 | See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables/) variable `STATUS_HEALTHCHECKINTERVAL`.                                                                                                                                      |
| 1405   | a key file could not be read                                                                                                                                                                                                | For binary deployment, validate that your user running the agent has access to the key file. For docker deployment on Linux, give the User ID in the container read access to the file `setfacl -m u:2500:r private_key.pem`.                                                          |
| 1406   | using a DOSA_* service account with Marketplace Provisioning is unsupported, Please use a Platform service account instead of legacy service account                                                                        | See [Reference - Agent configuration](/docs/connect_manage_environ/connect_api_manager/agent-variables/).                                                                                                                                                                              |
| 1410   | invalid configuration settings for the logging setup                                                                                                                                                                        | See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables/) for logging configuration options.                                                                                                                                          |
| 1503   | http transport is not connected                                                                                                                                                                                             | Check the TRACEABILITY_HOST setting. See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                                                                                                        |
| 1504   | failed to encode the json content                                                                                                                                                                                           | Internal system error. Contact your system administrator.                                                                                                                                                                                                                              |
| 1505   | invalid traceability config                                                                                                                                                                                                 | See [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables) for the Traceability configuration.                                                                                                                                          |
| 1506   | error while compiling regular expression                                                                                                                                                                                    | See [Trace redaction](/docs/connect_manage_environ/connected_agent_common_reference/trace_redaction/).                                                                                                                                                                                 |
| 1510   | global redactions have not been initialized                                                                                                                                                                                 | See [Trace redaction](/docs/connect_manage_environ/connected_agent_common_reference/trace_redaction/).                                                                                                                                                                                 |
| 1511   | error while compiling regular expression                                                                                                                                                                                    | See [Trace redaction](/docs/connect_manage_environ/connected_agent_common_reference/trace_redaction/).                                                                                                                                                                                 |
| 1520   | global sampling has not been initialized                                                                                                                                                                                    | See [Trace sampling](/docs/connect_manage_environ/connected_agent_common_reference/trace_sampling/).                                                                                                                                                                                   |
| 1521   | invalid sampling configuration                                                                                                                                                                                              | See [Trace sampling](/docs/connect_manage_environ/connected_agent_common_reference/trace_sampling/).                                                                                                                                                                                   |
| 1550   | error hit while applying redaction                                                                                                                                                                                          | See [Trace redaction](/docs/connect_manage_environ/connected_agent_common_reference/trace_redaction/).                                                                                                                                                                                 |
| 1600   | error registering the job                                                                                                                                                                                                   | The agent attempted to register a job, but could not do so successfully.                                                                                                                                                                                                               |
| 1601   | error executing a job                                                                                                                                                                                                       | A job defined in the agent failed, see the logs for more information.                                                                                                                                                                                                                  |
| 1602   | error executing a retry job                                                                                                                                                                                                 | A job defined in the agent failed, see the logs for more information.                                                                                                                                                                                                                  |
| 1613   | terminating agent, another instance of agent already running                                                                                                                                                                | Another agent of the same type is already running. Check with `ps-ef _agent` to find the PID of already running agent and kill it if necessary.                                                                                                                                        |
|        | **Specific error for Azure Discovery agents**                                                                                                                                                                               |                                                                                                                                                                                                                                                                                        |
| 4000   | missing or invalid configuration value for Azure APIM service                                                                                                                                                               | See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/) and [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                      |
| 4100   | error creating a service in Enterprise Marketplace for API on Azure APIM service                                                                                                                                            | See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/) and [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                      |
| 4101   | error getting API specification for API on Azure APIM service                                                                                                                                                               | See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/).                                                                                                                                                                |
|        | **Specific error for Azure Traceability agents**                                                                                                                                                                            |                                                                                                                                                                                                                                                                                        |
| 4500   | missing or invalid configuration value for Azure APIM service                                                                                                                                                               | See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/) and [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                      |
| 4501   | invalid Event Hub consumer group name. Please be sure the name begins with a $, number or letter. Ends with a number or letter. Contains alphanumerics, hyphens, periods, and/or underscores. Allowable length is 50 chars. | See [Administer Azure network traffic](/docs/connect_manage_environ/connected_agent_common_reference/network_traffic/) and [Reference - Agent configuration](/docs/connect_manage_environ/connect_azure_gateway/agent-variables).                                                      |

## Limitations

* Azure versioning not taken into account while discovering APIs
